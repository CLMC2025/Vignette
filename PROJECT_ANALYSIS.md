# Vignette é¡¹ç›®æ·±åº¦åˆ†ææŠ¥å‘Š

**åˆ†ææ—¥æœŸ**: 2026-02-17  
**åˆ†æè€…**: GitHub Copilot  
**ä»£ç åº“**: CLMC2025/Vignette

---

## æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘Šå¯¹ Vignette (å¾®è¯­å•è¯) HarmonyOS NEXT åº”ç”¨è¿›è¡Œäº†å…¨é¢çš„ä»£ç å®¡æŸ¥å’Œå®‰å…¨åˆ†æã€‚é¡¹ç›®æ•´ä½“æ¶æ„è‰¯å¥½ï¼Œä½†å‘ç°äº†ä¸€äº›éœ€è¦ç«‹å³ä¿®å¤çš„å®‰å…¨é—®é¢˜å’Œä»£ç è´¨é‡é—®é¢˜ã€‚

### å…³é”®æŒ‡æ ‡
- **æ€»ä»£ç è¡Œæ•°**: 53,910 è¡Œ
- **ArkTS æ–‡ä»¶æ•°**: 213 ä¸ª
- **é”™è¯¯å¤„ç†è¦†ç›–**: 345 ä¸ª catch å—
- **å®‰å…¨ç›¸å…³æ–‡ä»¶**: 21 ä¸ªæ¶‰åŠå¯†ç /å¯†é’¥å¤„ç†
- **ArkTS åˆè§„æ€§é—®é¢˜**: 569 ä¸ªè­¦å‘Š

---

## ğŸ”´ ä¸¥é‡é—®é¢˜ (Critical Issues)

### 1. ä¸å®‰å…¨çš„å…¨å±€å˜é‡ä½¿ç”¨

**ä½ç½®**: `entry/src/main/ets/utils/SecureStorage.ets:154`

**é—®é¢˜æè¿°**:
```typescript
await preferences.deletePreferences(globalThis.abilityContext, SecureStorage.PREFERENCES_NAME);
```

`clearAll()` æ–¹æ³•ä½¿ç”¨äº† `globalThis.abilityContext` è€Œä¸æ˜¯å®ä¾‹çš„ `this.abilityContext`ã€‚è¿™ä¼šå¯¼è‡´ï¼š
- å¦‚æœ `globalThis.abilityContext` æœªå®šä¹‰ï¼Œä¼šæŠ›å‡ºé”™è¯¯
- ä¸ä¸€è‡´çš„ä¸Šä¸‹æ–‡ç®¡ç†
- æ½œåœ¨çš„å†…å­˜æ³„æ¼

**å»ºè®®ä¿®å¤**:
```typescript
if (!this.abilityContext) {
  console.error('[SecureStorage] abilityContext is not available');
  return false;
}
await preferences.deletePreferences(this.abilityContext, SecureStorage.PREFERENCES_NAME);
```

**é£é™©ç­‰çº§**: é«˜  
**å½±å“**: åº”ç”¨åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½å´©æºƒæˆ–æ•°æ®æ¸…ç†å¤±è´¥

---

### 2. åŠ å¯†å›é€€æœºåˆ¶ä½¿ç”¨ä¸å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨

**ä½ç½®**: `entry/src/main/ets/sync/webdav/WebDavCrypto.ets:79-86`

**é—®é¢˜æè¿°**:
```typescript
catch (e) {
  // Fallback: use Math.random() only if cryptoFramework fails
  console.warn('[WebDavCrypto] cryptoFramework failed, using fallback:', e);
  const out = new Uint8Array(len);
  for (let i = 0; i < len; i++) {
    out[i] = Math.floor(Math.random() * 256) & 0xff;
  }
  return out;
}
```

`Math.random()` ä¸æ˜¯å¯†ç å­¦å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨ã€‚åœ¨åŠ å¯†åœºæ™¯ä¸­ä½¿ç”¨å®ƒä¼šä¸¥é‡å‰Šå¼±åŠ å¯†å¼ºåº¦ã€‚

**é—®é¢˜**:
- `Math.random()` æ˜¯ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œä¸é€‚åˆåŠ å¯†
- æ”»å‡»è€…å¯èƒ½é¢„æµ‹ç”Ÿæˆçš„éšæœºæ•°
- ä¼šå¯¼è‡´åŠ å¯†å¯†é’¥ã€ç›å€¼ã€IV ç­‰å…³é”®å‚æ•°å¯é¢„æµ‹

**å»ºè®®ä¿®å¤**:
1. **é¦–é€‰æ–¹æ¡ˆ**: ç¡®ä¿ cryptoFramework å§‹ç»ˆå¯ç”¨ï¼Œä¸æä¾›å›é€€
2. **å¤‡é€‰æ–¹æ¡ˆ**: å¦‚æœå¿…é¡»å›é€€ï¼Œåº”è¯¥æŠ›å‡ºé”™è¯¯è€Œä¸æ˜¯ä½¿ç”¨ä¸å®‰å…¨çš„éšæœºæ•°

```typescript
catch (e) {
  console.error('[WebDavCrypto] CRITICAL: cryptoFramework failed, cannot generate secure random:', e);
  throw new CryptoError('æ— æ³•ç”Ÿæˆå®‰å…¨éšæœºæ•°ï¼šç³»ç»ŸåŠ å¯†æœåŠ¡ä¸å¯ç”¨');
}
```

**é£é™©ç­‰çº§**: ä¸¥é‡  
**å½±å“**: 
- WebDAV åŒæ­¥æ•°æ®çš„åŠ å¯†å®‰å…¨æ€§å¯èƒ½è¢«ç ´å
- ç”¨æˆ·æ•°æ®å¯èƒ½è¢«æ”»å‡»è€…è§£å¯†
- è¿ååŠ å¯†æœ€ä½³å®è·µ

---

## ğŸŸ¡ ä¸­ç­‰é—®é¢˜ (Medium Issues)

### 3. ArkTS ä»£ç åˆè§„æ€§é—®é¢˜

**ä½ç½®**: å¤šä¸ªæ–‡ä»¶ï¼Œè¯¦è§ `compliance-report.md`

**ç»Ÿè®¡**:
- å—å½±å“æ–‡ä»¶: 10 ä¸ª
- æ€»é—®é¢˜æ•°: 569 ä¸ª

**ä¸»è¦é—®é¢˜ç±»å‹**:
1. **NO_UI_IN_MODEL** (492 ä¸ª): UI ä»£ç åœ¨ä¸šåŠ¡é€»è¾‘å±‚
2. **NO_PARAM_DESTRUCTURING** (76 ä¸ª): å‚æ•°è§£æ„é—®é¢˜
3. **NO_DESTRUCTURING** (1 ä¸ª): æœªä½¿ç”¨è§£æ„

**ç¤ºä¾‹é—®é¢˜**:

`entry/src/main/ets/pages/Index.ets`:
- å¤§é‡ UI ç»„ä»¶ä»£ç ï¼ˆText, Column, Rowï¼‰åœ¨é¡µé¢ç»„ä»¶ä¸­
- è¿™è¿åäº† ArkTS çš„ç»„ä»¶åˆ†ç¦»åŸåˆ™

**å»ºè®®ä¿®å¤**:
- å°† UI ç»„ä»¶æå–åˆ°ç‹¬ç«‹çš„ `@Component` ä¸­
- ä½¿ç”¨ `@Builder` æ„å»ºå¯å¤ç”¨çš„ UI å—
- éµå¾ª HarmonyOS NEXT çš„ç»„ä»¶åŒ–è®¾è®¡æ¨¡å¼

**é£é™©ç­‰çº§**: ä¸­  
**å½±å“**: 
- ä»£ç å¯ç»´æŠ¤æ€§é™ä½
- å¯èƒ½å½±å“æ€§èƒ½ä¼˜åŒ–
- ä¸ç¬¦åˆå®˜æ–¹æœ€ä½³å®è·µ

---

### 4. ç¼ºå°‘å®Œæ•´çš„æ„å»ºå’Œæµ‹è¯•ç¯å¢ƒ

**é—®é¢˜æè¿°**:
è¿è¡Œ `npm test` æ—¶å‡ºç°é”™è¯¯ï¼š
```
[npm test] æœªæ‰¾åˆ° hvigorwã€‚è¯·åœ¨ DevEco Studio/HarmonyOS æ„å»ºç¯å¢ƒä¸­è¿è¡Œï¼Œæˆ–å°† hvigorw æ”¾åˆ°ä»“åº“æ ¹ç›®å½•ã€‚
```

**å½±å“**:
- æ— æ³•åœ¨ CI/CD ç¯å¢ƒä¸­è‡ªåŠ¨æµ‹è¯•
- å¼€å‘è€…å¿…é¡»ä½¿ç”¨ DevEco Studio
- éš¾ä»¥éªŒè¯ä»£ç è´¨é‡

**å»ºè®®**:
1. æ·»åŠ  hvigorw åˆ°ç‰ˆæœ¬æ§åˆ¶
2. æä¾›ç‹¬ç«‹çš„æµ‹è¯•è„šæœ¬
3. é…ç½® CI/CD æµç¨‹

**é£é™©ç­‰çº§**: ä¸­  
**å½±å“**: å¼€å‘æµç¨‹å’Œè´¨é‡ä¿è¯

---

## ğŸŸ¢ è½»å¾®é—®é¢˜ (Minor Issues)

### 5. éåŠ å¯†åœºæ™¯ä½¿ç”¨ Math.random()

**ä½ç½®**: 
- `entry/src/main/ets/context/OfflineContext.ets:58`
- `entry/src/main/ets/context/TemplateBuilder.ets` (å¤šå¤„)

**è¯´æ˜**: è¿™äº›ç”¨ä¾‹ç”¨äº UI å±•ç¤ºå’Œéå®‰å…¨ç›¸å…³çš„éšæœºé€‰æ‹©ï¼Œä½¿ç”¨ `Math.random()` æ˜¯å¯æ¥å—çš„ã€‚

**å»ºè®®**: æ·»åŠ æ³¨é‡Šè¯´æ˜è¿™äº›ç”¨ä¾‹ä¸æ¶‰åŠå®‰å…¨æ€§ã€‚

---

### 6. ä»£ç ç»Ÿè®¡å»ºè®®

**ä¼˜ç‚¹**:
âœ… è‰¯å¥½çš„é”™è¯¯å¤„ç†è¦†ç›– (345 ä¸ª catch å—)  
âœ… ä¸°å¯Œçš„æ—¥å¿—è®°å½• (220 å¤„ console.error/warn)  
âœ… æ—  TODO/FIXME æ³¨é‡Šé—ç•™  
âœ… æ—  eval æˆ–å±é™©ä»£ç æ³¨å…¥  

**æ”¹è¿›ç‚¹**:
- è€ƒè™‘å¢åŠ å•å…ƒæµ‹è¯•è¦†ç›–ç‡
- ç»Ÿä¸€é”™è¯¯å¤„ç†ç­–ç•¥
- æ·»åŠ æ€§èƒ½ç›‘æ§ç‚¹

---

## å®‰å…¨å®¡è®¡

### å¯†ç å’Œå¯†é’¥ç®¡ç†

**SecureStorage** (`entry/src/main/ets/utils/SecureStorage.ets`):
- âœ… ä½¿ç”¨ HarmonyOS Preferences å­˜å‚¨
- âœ… é€šè¿‡ç³»ç»Ÿçº§æƒé™ä¿æŠ¤
- âš ï¸ globalThis ä½¿ç”¨é—®é¢˜ï¼ˆè§ä¸¥é‡é—®é¢˜ #1ï¼‰

**WebDavCrypto** (`entry/src/main/ets/sync/webdav/WebDavCrypto.ets`):
- âœ… ä½¿ç”¨ PBKDF2-HMAC-SHA256 å¯†é’¥æ´¾ç”Ÿ
- âœ… ä½¿ç”¨ AES-256-CTR åŠ å¯†
- âœ… ä½¿ç”¨ HMAC-SHA256 è¿›è¡Œå®Œæ•´æ€§éªŒè¯
- ğŸ”´ ä¸å®‰å…¨çš„éšæœºæ•°å›é€€ï¼ˆè§ä¸¥é‡é—®é¢˜ #2ï¼‰

### æƒé™ä½¿ç”¨

æ£€æŸ¥ `entry/src/main/module.json5`:
```json
{
  "requestPermissions": [
    {
      "name": "ohos.permission.INTERNET",
      "usedScene": { "abilities": ["EntryAbility"], "when": "inuse" }
    },
    {
      "name": "ohos.permission.VIBRATE",
      "usedScene": { "abilities": ["EntryAbility"], "when": "inuse" }
    }
  ]
}
```

âœ… **è¯„ä¼°**: æƒé™è¯·æ±‚åˆç†ä¸”æœ€å°åŒ–
- INTERNET: ç”¨äº AI API è°ƒç”¨å’Œ WebDAV åŒæ­¥
- VIBRATE: ç”¨äºå­¦ä¹ åé¦ˆ

---

## æ¶æ„åˆ†æ

### ç›®å½•ç»“æ„
```
entry/src/main/ets/
â”œâ”€â”€ algorithm/          # FSRS ç®—æ³•å®ç°
â”œâ”€â”€ components/         # UI ç»„ä»¶
â”œâ”€â”€ context/            # ä¸Šä¸‹æ–‡ç®¡ç†
â”œâ”€â”€ database/           # æ•°æ®åº“å±‚
â”‚   â””â”€â”€ repositories/   # ä»“å‚¨æ¨¡å¼
â”œâ”€â”€ manager/            # ä¸šåŠ¡é€»è¾‘ç®¡ç†å™¨
â”‚   â””â”€â”€ dictionary/     # è¯å…¸ç›¸å…³
â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ index/          # é¦–é¡µ
â”‚   â””â”€â”€ learning/       # å­¦ä¹ é¡µé¢
â”œâ”€â”€ sync/               # åŒæ­¥æ¨¡å—
â”‚   â””â”€â”€ webdav/         # WebDAV å®ç°
â”œâ”€â”€ utils/              # å·¥å…·ç±»
â””â”€â”€ vocabulary/         # è¯æ±‡ç®¡ç†
```

âœ… **ä¼˜ç‚¹**:
- æ¸…æ™°çš„åˆ†å±‚æ¶æ„
- éµå¾ªå•ä¸€èŒè´£åŸåˆ™
- è‰¯å¥½çš„æ¨¡å—åŒ–

âš ï¸ **æ”¹è¿›å»ºè®®**:
- `pages/` ä¸‹çš„ç»„ä»¶è¿‡å¤§ï¼Œè€ƒè™‘è¿›ä¸€æ­¥æ‹†åˆ†
- æ·»åŠ æ›´å¤šå•å…ƒæµ‹è¯•æ–‡ä»¶

---

## ä¾èµ–åˆ†æ

### package.json
```json
{
  "dependencies": {},
  "devDependencies": {
    "@ohos/hypium": "1.0.24",
    "@ohos/hamock": "1.0.0"
  }
}
```

âœ… **æ— å¤–éƒ¨ä¾èµ–**ï¼Œé™ä½äº†ä¾›åº”é“¾æ”»å‡»é£é™©

---

## æ€§èƒ½è€ƒé‡

### å¼‚æ­¥æ“ä½œ
- å‘ç° 291 ä¸ªå¼‚æ­¥å‡½æ•°
- Promise é”™è¯¯å¤„ç†: 10 å¤„ä½¿ç”¨ `.catch()`
- å¤§éƒ¨åˆ†ä½¿ç”¨ try-catch æ¨¡å¼ âœ…

### æ•°æ®åº“æ“ä½œ
- ä½¿ç”¨ RdbStore (SQLite)
- å®ç°äº†ä»“å‚¨æ¨¡å¼
- æœ‰é€‚å½“çš„è¿æ¥ç®¡ç†

---

## å»ºè®®çš„ä¼˜å…ˆçº§ä¿®å¤é¡ºåº

### ç«‹å³ä¿®å¤ (P0)
1. âœ… ä¿®å¤ WebDavCrypto ä¸å®‰å…¨çš„éšæœºæ•°å›é€€
2. âœ… ä¿®å¤ SecureStorage globalThis å¼•ç”¨é—®é¢˜

### çŸ­æœŸä¿®å¤ (P1 - 1-2å‘¨)
3. âš™ï¸ è§£å†³ä¸»è¦çš„ ArkTS åˆè§„æ€§é—®é¢˜
4. âš™ï¸ é…ç½® CI/CD æµ‹è¯•ç¯å¢ƒ

### ä¸­æœŸæ”¹è¿› (P2 - 1ä¸ªæœˆ)
5. ğŸ“ å¢åŠ å•å…ƒæµ‹è¯•è¦†ç›–ç‡
6. ğŸ“ ä¼˜åŒ–å¤§å‹ç»„ä»¶ï¼Œæé«˜å¯ç»´æŠ¤æ€§
7. ğŸ“ æ·»åŠ æ€§èƒ½ç›‘æ§

### é•¿æœŸä¼˜åŒ– (P3 - æŒç»­)
8. ğŸ“š å®Œå–„æ–‡æ¡£
9. ğŸ” ä»£ç å®¡æŸ¥æµç¨‹
10. ğŸš€ æ€§èƒ½ä¼˜åŒ–

---

## æ€»ç»“

**æ€»ä½“è¯„ä»·**: â­â­â­â­â˜† (4/5)

Vignette æ˜¯ä¸€ä¸ªç»“æ„è‰¯å¥½ã€åŠŸèƒ½å®Œæ•´çš„ HarmonyOS NEXT åº”ç”¨ã€‚ä»£ç è´¨é‡æ€»ä½“è¾ƒé«˜ï¼Œæœ‰è‰¯å¥½çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ã€‚ä½†å­˜åœ¨ä¸¤ä¸ªä¸¥é‡çš„å®‰å…¨é—®é¢˜éœ€è¦ç«‹å³ä¿®å¤ï¼š

1. åŠ å¯†æ¨¡å—çš„ä¸å®‰å…¨éšæœºæ•°å›é€€
2. SecureStorage çš„å…¨å±€å˜é‡å¼•ç”¨é”™è¯¯

ä¿®å¤è¿™ä¸¤ä¸ªé—®é¢˜åï¼Œé¡¹ç›®çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§å°†æ˜¾è‘—æå‡ã€‚

**æ¨èè¡ŒåŠ¨**:
- ğŸ”´ ç«‹å³ä¿®å¤ä¸¤ä¸ªä¸¥é‡å®‰å…¨é—®é¢˜
- ğŸŸ¡ åˆ¶å®š ArkTS åˆè§„æ€§æ”¹è¿›è®¡åˆ’
- ğŸŸ¢ æŒç»­æ”¹è¿›ä»£ç è´¨é‡å’Œæµ‹è¯•è¦†ç›–ç‡

---

## é™„å½•

### ç»Ÿè®¡æ•°æ®æ‘˜è¦
| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ€»ä»£ç è¡Œæ•° | 53,910 |
| ArkTS æ–‡ä»¶æ•° | 213 |
| é”™è¯¯å¤„ç† (catch) | 345 |
| æ—¥å¿—è®°å½• | 220 |
| å®‰å…¨ç›¸å…³æ–‡ä»¶ | 21 |
| ArkTS è­¦å‘Š | 569 |
| TODO/FIXME | 0 |
| å¤–éƒ¨ä¾èµ– | 0 |

### å‚è€ƒæ–‡æ¡£
- [HarmonyOS NEXT å¼€å‘æ–‡æ¡£](https://developer.huawei.com/consumer/cn/doc/)
- [ArkTS è¯­è¨€è§„èŒƒ](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-basics-V5)
- [OWASP Mobile Security](https://owasp.org/www-project-mobile-security/)

---

**æŠ¥å‘Šç»“æŸ**
