import { describe, it, expect } from '@ohos/hypium';

import { isLikelyAudioResponse } from '../../../main/ets/utils/TtsAudioFetcher';

export default function ttsAudioFetcherTest(): void {
  describe('TtsAudioFetcher', () => {
    it('should validate audio responses', 0, () => {
      const mp3Id3 = new Uint8Array([0x49, 0x44, 0x33, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]);
      expect(isLikelyAudioResponse(200, 'audio/mpeg', mp3Id3)).assertTrue();
      expect(isLikelyAudioResponse(200, 'application/octet-stream', mp3Id3)).assertTrue();
      expect(isLikelyAudioResponse(200, '', mp3Id3)).assertTrue();

      const html = new Uint8Array([0x3c, 0x68, 0x74, 0x6d, 0x6c, 0x3e, 0x6e, 0x6f, 0x3c, 0x2f, 0x68, 0x74, 0x6d, 0x6c, 0x3e]);
      expect(isLikelyAudioResponse(200, 'text/html', html)).assertFalse();
      expect(isLikelyAudioResponse(404, 'audio/mpeg', mp3Id3)).assertFalse();
      expect(isLikelyAudioResponse(200, 'audio/mpeg', new Uint8Array([0x49, 0x44, 0x33]))).assertFalse();
    });
  });
}
