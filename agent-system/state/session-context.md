# 会话上下文

> 本文件存储当前会话的关键上下文信息，帮助下一个代理快速理解项目状态。

---

## 项目概述

### 基本信息
- **项目名称**：微语单词 (Vignette)
- **项目类型**：HarmonyOS NEXT 应用
- **开发语言**：ArkTS (TypeScript 扩展)
- **目标平台**：HarmonyOS NEXT (API 12+)

### 核心功能
一款面向 HarmonyOS 的 AI 语境背单词应用，基于最新 FSRS 算法和 Anki 风格交互，聚焦智能、高效的学习体验。

### 技术栈
- **UI框架**：ArkUI (鸿蒙原生)
- **状态管理**：@State, @Link, @Prop, AppStorage
- **数据库**：RdbStore (关系型数据库)
- **网络**：HTTP请求, WebDAV同步
- **AI集成**：支持多种AI API (OpenAI兼容)，用于语境生成
- **算法**：最新版FSRS v6.1.1算法 (间隔重复)
- **参考项目**：WordEcho (阅读模式)、Anki (学习交互)

---

## 功能实现状态

### 已完成功能 (verified/completed)
| 功能ID | 功能名称 | 状态 | 说明 |
|--------|----------|------|------|
| F-002 | FSRS算法 | verified | FSRS v6.1.1，支持参数优化 |
| F-003 | Anki风格学习交互 | completed | 四档评分系统 |
| F-005 | 数据持久化 | verified | 数据库+设置存储 |
| F-009 | TTS语音播放 | verified | 单词/句子发音 |
| F-011 | WebDAV同步 | verified | 多设备同步+加密 |

### 已有基础需增强
| 功能ID | 功能名称 | 已实现 | 待增强 |
|--------|----------|--------|--------|
| F-006 | 语境故事生成 | 风格/难度枚举、模板系统 | 用户自定义UI、质量评估 |
| F-007 | 鸿蒙原生UI动效 | 动画组件、粒子效果 | 手势操作、震动反馈 |
| F-010 | 设置页面 | 各设置模块 | 主题自定义UI |
| F-012 | 主题与外观 | 浅色/深色切换 | 多套主题、自定义色 |

### 待实现功能
- F-001: AI语境背单词核心流程
- F-004: 词书管理系统
- F-008: 学习统计系统
- F-013~F-025: 增强功能

---

## 最近会话摘要

### Session 2026-02-13 (当前)
- **完成的功能**：
  - 更新AI开发系统需求
  - 标记已实现功能状态
  - 添加用户体验增强功能
- **关键决策**：
  - 核心功能定位为AI语境背单词
  - 已实现FSRS v6.1.1算法
  - 已实现Anki四档评分系统
  - 难度等级按考试类型分（高考/四六级/考研/雅思/托福/GRE等）
  - 语境风格支持自定义（对话/正式/幽默/叙述/技术等）
- **遗留问题**：无

### Session 2025-02-13
- **完成的功能**：系统初始化
- **关键决策**：
  - 采用双代理架构（初始化代理 + 编码代理）
  - 功能粒度控制在1-3个/会话
  - 使用Markdown文件进行状态持久化
- **遗留问题**：无

---

## 当前焦点

### 正在处理
- 功能需求列表已更新完成
- 已标记5个功能为verified/completed
- 待开始剩余核心功能实现

### 优先级队列
1. F-001: AI语境背单词核心流程 (P0) - 待实现
2. F-004: 词书管理系统 (P0) - 待实现
3. F-006: 语境故事生成 (P0) - 需增强
4. F-008: 学习统计系统 (P1) - 待实现
5. F-012: 主题与外观自定义 (P1) - 需增强

### 阻塞项
- 无

---

## 关键设计决策

### 1. 架构设计
- **目录结构**：遵循HarmonyOS标准结构
- **组件化**：页面拆分为多个子组件
- **状态管理**：最小化状态共享范围
- **AI集成**：模块化的AI服务，支持多种AI API

### 2. 数据模型
- **单词实体**：WordEntity, WordModel
- **词书实体**：BookModels
- **学习记录**：ReviewEvent, FSRS参数
- **语境数据**：AI生成的语境故事

### 3. 同步策略
- **WebDAV**：支持多设备同步
- **冲突解决**：基于时间戳的自动合并
- **加密**：敏感数据加密存储

### 4. AI语境生成策略
- **多API支持**：兼容OpenAI等多种AI服务
- **模板系统**：结构化的语境生成模板
- **风格类型**：随机/对话/正式/幽默/叙述/技术/自定义
- **难度等级**：入门/四级/六级/考研/雅思/托福/SAT/GRE/高级
- **质量控制**：语境质量评估机制
- **缓存策略**：生成的语境本地缓存

### 5. Anki风格交互设计
- **四档评分**：Again/Hard/Good/Easy
- **间隔计算**：基于FSRS v6.1.1算法
- **学习流程**：参考Anki的复习逻辑
- **进度跟踪**：详细的学习数据统计

### 6. 鸿蒙原生UI规范
- **设计语言**：遵循鸿蒙设计规范
- **动画效果**：流畅的页面过渡和交互反馈
- **响应式布局**：适配不同屏幕尺寸
- **性能优化**：减少重渲染，优化动画性能

### 7. 用户体验增强
- **语境风格自定义**：用户可选择或自定义语境风格
- **考试类型难度**：按高考/四六级/考研等分类
- **主题自定义**：多套预设主题+自定义主题色
- **手势操作**：滑动翻卡、长按快捷操作
- **学习计划**：创建计划、进度追踪、提醒通知

---

## 代码规范

### 命名规范
- 类/接口/组件：PascalCase
- 变量/函数：camelCase
- 常量：UPPER_SNAKE_CASE

### 文件规范
- 组件文件：PascalCase.ets
- 工具文件：camelCase.ets
- 模型文件：PascalCase.ets/.ts

### 禁止事项
- ❌ 禁止使用 any 和 unknown
- ❌ 禁止硬编码 px 像素值
- ❌ 禁止动态添加/删除属性

---

## 已知问题

| ID | 描述 | 状态 | 影响 |
|----|------|------|------|
| - | 暂无已知问题 | - | - |

---

## 测试策略

### 单元测试
- 位置：entry/src/ohosTest/ets/test/
- 框架：@ohos/hypium
- 覆盖：工具函数、算法、数据模型

### 集成测试
- 数据库操作
- API调用
- 同步功能

---

> 最后更新：2026-02-13
